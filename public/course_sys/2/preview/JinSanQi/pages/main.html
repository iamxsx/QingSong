<div id="warp" data-qscid="mainpage">
    <link href="main.css" rel="stylesheet">
    
    <div class="top">
        <img src="main/logo_bg[1].png" class="logobg">
        <img src="main/logo[1].png" class="logo">
        <div class="toptool">
            <div class="toptool_btngroup">
                <div class="toptool_btn"><img src="main/nav_0[1].png"></div>
                <div class="toptool_btn"><img src="main/nav_3[1].png"></div>
                <div class="toptool_btn"><img src="main/nav_2[1].png"></div>
                <div class="toptool_btn"><img src="main/nav_3[1].png"></div>
                <div class="toptool_btn"><img src="main/nav_1[1].png"></div>
            </div>
            <img src="main/nav_line[1].jpg">
            <div class="toptool_state">
                <p>您好：张三，XX税务局征收股</p>
                <p>当前操作：待办事宜</p>
            </div>
        </div>
    </div>
    
    <div class="content">
        <div class="siderbar" data-qscid="siderbar">
<!--            侧边栏-->
            <div class="siderbarcontent">
                <div class="searchbox" data-blinkid="searchbox">
                    <img src="main/ss_l[1].png">
                    <img src="main/ss_r[1].png" class="searchbox_search">
                    <input placeholder="输入功能名称或拼音模糊查询" id="sb_search" data-qscid="sb_search">
                </div>
                <div class="siderbarnavbtn active" data-snavfor="usual">
                    <img src="main/left_nav_icon1[1].png">
                    <div>常用功能</div>
                </div>
                <div class="siderbar_listcontainer" data-snavpanel="usual">
                    
                </div>
                
                <div class="siderbarnavbtn" data-snavfor="function">
                    <img src="main/left_nav_icon2[1].png">
                    <div>功能菜单</div>
                </div>
                <div class="siderbar_listcontainer" data-snavpanel="function" style="display:none"></div>
                
                <div class="siderbarnavbtn" data-snavfor="sys">
                    <img src="main/left_nav_icon3[1].png">
                    <div>系统功能</div>
                </div>
                <div class="siderbar_listcontainer" data-snavpanel="sys" style="display:none"></div>
                
                <div class="siderbarnavbtn" data-snavfor="search">
                    <img src="main/left_nav_icon4[1].png">
                    <div>搜索结果</div>
                </div>
                <div class="siderbar_listcontainer" data-snavpanel="search" style="display:none" data-qscid="searchresult"></div>
                
            </div>
            <div class="siderbarexpand">
                <div class="siderbarexpandbtn"></div>
            </div>
        </div>
<!--        右边正式内容-->
        <div class="mainblock">
            <div class="tabline">
                <div class="tabbottomline"></div>
                <div class="tabbtngroup" id="tabbtngroup">
                    <div class="tabbtn active" data-formodule="module/index.html">
                        <div>首页</div>
                    </div>
                </div>
                <div class="tabrightbtngroup">
                    <div class="tabrightbtn"></div>
                    <div class="tabrightbtn2"></div>
                    <div class="tabrightbtn3"></div>
                </div>
            </div>
            <div class="modulegroup" id="modulegroup" data-qscid="modulegroup">
                <div class="modulepart" data-module="module/index.html"></div>
            </div>
        </div>
    </div>
    
    <script>
        (function(){
            //加载默认显示的模块
            Qsc.getPart("module/index.html","[data-module='module/index.html']");
            Qsc.bind($("[data-formodule='module/index.html']"),"click",function(){ showModule("module/index.html"); });
            
            Qsc.bind($(".siderbarexpand"),"click",function(){
                if($(".siderbarcontent").css("display")=="none"){
                    $(".siderbarcontent").css("display","inline-block");
                    $(".siderbarexpandbtn").css("background-image","url("+Qsc.getImageUrl("main/s_l[1].png")+")");
                    $(".siderbarexpand").css("margin-left","-5px");
                }else{
                    $(".siderbarcontent").css("display","none");
                    $(".siderbarexpandbtn").css("background-image","url("+Qsc.getImageUrl("main/s_r[1].png")+")");
                    $(".siderbarexpand").css("margin-left","0");
                }
            });

            Qsc.bind($(".siderbarnavbtn"),"click",function(){
                var types = ["usual","function","sys","search"];
                for(var k in types){
                    $("[data-snavfor='"+types[k]+"']").removeClass("active");
                    $("[data-snavpanel='"+types[k]+"']").css("display","none");
                }
                var type = $(this).attr("data-snavfor");
                $("[data-snavfor='"+type+"']").addClass("active");
                $("[data-snavpanel='"+type+"']").css("display","block");
            });
            
            //存放侧边栏的数据
            Qsc.data['siderbar'] = {};
            Qsc.data['siderbar']['usual'] = [
                {
                    "title":"梅州市梅江区地方税务局",
                    "content":[
                        {"title":"税（费）种认定[纳税核定]","part":"module/shuizhongrending.html"},
                    ]
                }
            ];
            Qsc.data['siderbar']['function'] = [
                {
                    "title":"梅州市梅江区地方税务局",
                    "content":[
                        {"title":"税（费）种认定[纳税核定]","part":"module/shuizhongrending.html"}
                    ]
                }
            ];
            Qsc.data['siderbar']['sys'] = {};
            
            //用来唯一识别siderbar按钮
            var siderbarid = 0;
            
            //读取侧边栏的数据并写入到页面中
            function writeSiderBar(){
                
                var _addDir = function(title,selector,tab){
                    var _tempid = siderbarid;
                    $(selector).append("<div class=\"sb_listline\" data-snavtab='"+tab+"' data-sbid='"+_tempid+"' style='margin-left: "+(tab*15+25)+"px'>\n"+
                            "<div class=\"sb_treeline3\"></div>\n"+
                            "<img src=\""+Qsc.getImageUrl("main/tree-gadjet-plus[1].gif")+"\" class=\"sb_nodeicon\">\n"+
                            "<img src=\""+Qsc.getImageUrl("main/leaficon[1].gif")+"\" class=\"sb_itemicon\">\n"+
                            "<div class=\"sb_itemtitle\">"+title+"</div>"+
                    "</div>\n");
                    $(selector).append("<div data-snavid='"+_tempid+"' style='display:none'></div>");
                    Qsc.bind($("[data-sbid='"+_tempid+"']"),"click",function(){
                        if($("[data-snavid='"+_tempid+"']").css("display") == "none"){
                            $("[data-snavid='"+_tempid+"']").css("display","block");
                        }else{
                            $("[data-snavid='"+_tempid+"']").css("display","none");
                        }
                    });
                    siderbarid++;
                    return _tempid;
                }
                
                var _addFile = function(title,part,selector,tab){
                    $(selector).append("<div class=\"sb_listline\" data-snavtab='"+tab+"' data-sbid='"+siderbarid+"' style='margin-left: "+(tab*15+25)+"px'>\n"+
                            "<div class=\"sb_treeline\"></div>\n"+
                            "<div class=\"sb_treeline2\"></div>\n"+
                            "<img src=\""+Qsc.getImageUrl("main/closeicon[1].gif")+"\" class=\"sb_itemicon\">\n"+
                            "<div class=\"sb_itemtitle\">"+title+"</div>\n"+
                    "</div>\n");
                    Qsc.bind($("[data-sbid='"+siderbarid+"']"),"click",function(){
                        addNewModuleTabBtn(title,part);
                    });
                    siderbarid++;
                }
                
                //递归查询
                var _writeSiderList = function(dataset,selector,tab){
                    for(var i in dataset){
                        if(dataset[i]["content"] == undefined && dataset[i]["part"] != undefined){
                            _addFile(dataset[i]["title"],dataset[i]["part"],selector,tab);
                        }else if(dataset[i]["content"] != undefined){
                            var _siderbarid = _addDir(dataset[i]["title"],selector,tab);
                            tab++;
                            _writeSiderList(dataset[i]["content"],"[data-snavid='"+_siderbarid+"']",tab);
                        }
                    }
                }
                
                _writeSiderList(Qsc.data['siderbar']['usual'],"[data-snavpanel='usual']",0);
                _writeSiderList(Qsc.data['siderbar']['function'],"[data-snavpanel='function']",0);
                _writeSiderList(Qsc.data['siderbar']['sys'],"[data-snavpanel='sys']",0);
                
            }
            
            writeSiderBar();
            
            //添加新的模块tab按钮
            function addNewModuleTabBtn(title,part){
                //记录那个面板是否已经存在
                var isPanelExist = false;
                $.each($("#tabbtngroup").children("div[data-formodule]"),function(i,e){
                    if($(e).attr('data-formodule') == part){
                        isPanelExist = true;
                    }
                });
                if(!isPanelExist){
                    
                    //添加面板按钮
                    $("#tabbtngroup").append("<div class=\"tabbtn active\" data-formodule=\""+part+"\">\n"+
                                                "<div>"+title+"</div>\n" +
                                                "<img src=\""+Qsc.getImageUrl("main/esc_ico[1].gif")+"\" class='tabclosebtn'>\n" +
                                            "</div>");
                    
                    //添加整个面板
                    $("#modulegroup").append("<div class=\"modulepart\" data-module=\""+part+"\"></div>");
                    Qsc.getPart(part,"[data-module='"+part+"']");
                    
                    //绑定tab按钮事件
                    Qsc.bind($("[data-formodule='"+part+"']"),"click",function(){ showModule(part); });
                    Qsc.bind($("[data-formodule='"+part+"']").children("img"),"click",function(){ removeModule(part); });
                    showModule(part);
                }
            }
            
            //显示某个模块
            function showModule(part){
                $.each($("#tabbtngroup").children("div[data-formodule]"),function(i,e){
                    $(e).removeClass("active");
                });
                $.each($("#modulegroup").children("div[data-module]"),function(i,e){
                    $(e).css("display","none");
                });
                $("#tabbtngroup").children("div[data-formodule='"+part+"']").addClass("active");
                $("#modulegroup").children("div[data-module='"+part+"']").css("display","block");
            }
            
            //移除某个模块
            function removeModule(part){
                $("#tabbtngroup").children("div[data-formodule='"+part+"']").remove();
                $("#modulegroup").children("div[data-module='"+part+"']").remove();
            }
            
            //搜索侧边栏
            function searchInSiderBar(){
                if($("#sb_search").val().trim() == ""){
                    return;
                }
                $("[data-snavpanel='search']").html("");
                var content = $("#sb_search").val().trim();
                
                var searchsiderbarid = 0;
                //递归查询
                var _searchInSiderBar = function(dataset){
                    for(var i in dataset){
                        if(dataset[i]["content"] == undefined && dataset[i]["part"] != undefined){
                            if(dataset[i]["title"].indexOf(content)>=0){ //部分匹配
                                $("[data-snavpanel='search']").append("<div class=\"sb_listline\" data-search-sbid='"+searchsiderbarid+"' data-qscid='"+dataset[i]["part"]+"'>\n"+
                                        "<div class=\"sb_treeline\"></div>\n"+
                                        "<div class=\"sb_treeline2\"></div>\n"+
                                        "<img src=\""+Qsc.getImageUrl("main/closeicon[1].gif")+"\" class=\"sb_itemicon\">\n"+
                                        "<div class=\"sb_itemtitle\">"+dataset[i]["title"] +"</div>\n"+
                                "</div>\n");
                                Qsc.bind($("[data-search-sbid='"+searchsiderbarid+"']"),"click",function(){
                                    addNewModuleTabBtn(dataset[i]["title"],dataset[i]["part"]);
                                });
                                searchsiderbarid++;
                            }
                        }else if(dataset[i]["content"] != undefined){
                            _searchInSiderBar(dataset[i]["content"]);
                        }
                    }
                }
                
                _searchInSiderBar(Qsc.data['siderbar']['function']);
                _searchInSiderBar(Qsc.data['siderbar']['sys']);
                
                var types = ["usual","function","sys","search"];
                for(var k in types){
                    $("[data-snavfor='"+types[k]+"']").removeClass("active");
                    $("[data-snavpanel='"+types[k]+"']").css("display","none");
                }
                $("[data-snavfor='search']").addClass("active");
                $("[data-snavpanel='search']").css("display","block");
                
            }
            
            //绑定搜索事件
            Qsc.bind($("#sb_search"),"keydown",function(e){
                if(e.which == 13){
                    searchInSiderBar();
                }
            });
            Qsc.bind($(".searchbox_search"),"click",function(e){
                searchInSiderBar();
            });
            
            
        })();
    </script>
    
</div>