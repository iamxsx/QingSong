<div class="module_warp">
    <link href="module.css" rel="stylesheet">
    <!--工具栏-->
    <div class="module_toolbar">
        <div class="module_toolbar_btn" id="tb_savebtn" data-qscid="savebtn">
            <img src="main/save[1].png">
            <div>保存(S)</div>
        </div>
        <div class="module_toolbar_btn" id="tb_next" data-qscid="nextbtn">
            <img src="main/refresh[1].png">
            <div>下一户(D)</div>
        </div>
        <div class="module_toolbar_btn" id="tb_seeInfo">
            <div>查看核定信息(O)</div>
        </div>
        <div class="module_toolbar_btn" id="tb_seeVerify">
            <div>查看对方机关认定信息</div>
        </div>
    </div>
    <div class="module_main">
        <div class="module_tab_panel" data-qscid="basicinfopanel">
            <div class="module_tab_panel_tabs">
                <div class="module_tab_panel_tab active"><div>当前机关税（费）种认定</div></div>
            </div>
            <div class="module_tab_panel_contents">
                <div class="module_tab_panel_content">
                    <div class="module_form_basictitle">税（费）种认定-纳税人基本信息</div>
                    <table class="module_form_table" border="1" id="payer_basic_info">
                        <tr data-blinkid="payerId">
                            <td class="right">纳税人识别号</td>
                            <td class="left"><input type="text" data-type="payerId" data-qscid="payerId"></td>
                            <td class="right">纳税人名称</td>
                            <td class="left"><input type="text" disabled data-type="payerName"></td>
                        </tr>
                        <tr>
                            <td class="right">登记注册类型</td>
                            <td class="left"><input type="text" disabled data-type="regType"></td>
                            <td class="right">生产经营地址</td>
                            <td class="left"><input type="text" disabled data-type="businessAddr"></td>
                        </tr>
                        <tr>
                            <td class="right">生产经营行政区划</td>
                            <td class="left"><input type="text" disabled data-type="productDistribute"></td>
                            <td class="right">纳税人所处街乡</td>
                            <td class="left"><input type="text" disabled data-type="businessStreet"></td>
                        </tr>
                        <tr>
                            <td class="right">隶属关系</td>
                            <td class="left">
                                <select disabled data-type="relationship">
                                    <option></option>
                                    <option>区</option>
                                    <option>市</option>
                                    <option>省</option>
                                </select>
                            </td>
                            <td class="left" colspan="2"></td>
                        </tr>
                        <tr>
                            <td class="right">经营范围</td>
                            <td class="left" colspan="3"><textarea rows="3" disabled data-type="businessRange"></textarea></td>
                        </tr>
                        <tr>
                            <td class="right must">是否附征增值税附加</td>
                            <td class="left">
                                <div class="inputgroup">
                                    <input type="radio" value="是" name="zengzhishuifujia">
                                    <div>是</div>
                                </div>
                                <div class="inputgroup">
                                    <input type="radio" value="否" name="zengzhishuifujia" checked>
                                    <div>否</div>
                                </div>
                            </td>
                            <td class="right must">是否附征消费税附加</td>
                            <td class="left">
                                <div class="inputgroup">
                                    <input type="radio" value="是" name="xiaofeishuifujia">
                                    <div>是</div>
                                </div>
                                <div class="inputgroup">
                                    <input type="radio" value="否" name="xiaofeishuifujia" checked>
                                    <div>否</div>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="module_tab_panel" data-qscid="rendinged">
            <div class="module_tab_panel_tabs">
                <div class="module_tab_panel_tab active"><div>当前税（费）种认定信息</div></div>
                <div class="module_tab_panel_tab"><div>已申报税（费）种认定信息</div></div>
            </div>
            <div class="module_tab_panel_contents">
                <div class="module_tab_panel_content">
                    <div class="module_gridview" id="taxverifygv">
                        <div class="module_gridview_title">税（费）种认定-税（费）种认定信息列表</div>
                        <div class="module_gridview_content">
                            <table border="1" width="3470">
                                <tr>
                                    <th class="must" width="230">主附税标志</th>
                                    <th class="must" width="270">征收代理方式</th>
                                    <th class="must" width="270">行业</th>
                                    <th class="must" width="270">所需税务机关</th>
                                    <th class="must" width="270" data-qscid="t_TaxType">征收项目</th>
                                    <th class="must" width="270">认定有效期起</th>
                                    <th width="270">认定有效期止</th>
                                    <th class="must" width="270">征收品目</th>
                                    <th width="270">征收子目</th>
                                    <th class="must" width="270">税率或单位税额</th>
                                    <th class="must" width="270">纳税期限</th>
                                    <th class="must" width="270">申报期限</th>
                                    <th class="must" width="270">缴款期限</th>
                                </tr>
                            </table>
                        </div>
                        <div class="module_gridview_statusbar">
                            <div class="module_gridview_status">共0条</div>
                            <div class="module_gridview_status_btngroup">
                                <div class="module_gridview_status_normalbtn" id="addMainTax" data-qscid="addMainTax">增加主税</div>
                                <div class="module_gridview_status_normalbtn">提取模板</div>
                                <div class="module_gridview_status_normalbtn">附征</div>
                                <div class="module_gridview_status_normalbtn">批量附征</div>
                                <div class="module_gridview_status_normalbtn">删除税种</div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
        
    </div>
    
    <div class="listview_popup" id="listview" data-rowid="" data-type="" style="display:none" tabindex="1">
    </div>
    
    <div class="timepicker_popup" id="timepicker" data-rowid="" data-type="" style="display:none" tabindex="1">
        <div class="timepicker_content" data-pickertype="monthpicker">
            <div class="timepicker_title">
                <div class="timepicker_leftbtn">
                    <img src="main/next[1].gif">
                </div>
                <div class="timepicker_titlecontent"></div>
                <div class="timepicker_rightbtn">
                    <img src="main/pre[1].gif">
                </div>
            </div>
            <div class="timepicker_btngroup">
                <div class="timepicker_monthbtn">1月</div>
                <div class="timepicker_monthbtn">2月</div>
                <div class="timepicker_monthbtn">3月</div>
                <div class="timepicker_monthbtn">4月</div>
                <div class="timepicker_monthbtn">5月</div>
                <div class="timepicker_monthbtn">6月</div>
                <div class="timepicker_monthbtn">7月</div>
                <div class="timepicker_monthbtn">8月</div>
                <div class="timepicker_monthbtn">9月</div>
                <div class="timepicker_monthbtn">10月</div>
                <div class="timepicker_monthbtn">11月</div>
                <div class="timepicker_monthbtn">12月</div>
            </div>
        </div>
        <div class="timepicker_content" data-pickertype="daypicker" style="display:none;">
            <div class="timepicker_title">
                <div class="timepicker_leftbtn">
                    <img src="main/next[1].gif">
                </div>
                <div class="timepicker_titlecontent"></div>
                <div class="timepicker_rightbtn">
                    <img src="main/pre[1].gif">
                </div>
            </div>
            <div class="timepicker_btngroup">
                
            </div>
        </div>
    </div>
    
<!--    弹出窗口-->
    <div class="modal" id="modal">
        <div class="modal_windows" data-blinkid="modal">
            <div class="modal_title">
                <img src="main/ask[1].png">
                <div>提示框</div>
            </div>
            <div class="modal_content">
                <div class="modal_info">是否要保存？
                </div>
                <div class="modal_btngroup">
                    <div class="modal_btn" id="modal_verify" data-qscid="verifybtn">确定</div>
                    <div class="modal_btn" id="modal_cancel">取消</div>
                </div>
            </div>
        </div>
        <div class="modal_mask"></div>
    </div>
    
    
    <script>
        (function(){
            
            Qsc.bind($("#addMainTax"),"click",function(){
                addMainTaxLine();
            });
            
            Qsc.bind($("#listview"),"blur",function(){
                $("#listview").css("display","none");
            });
            
            //当输入纳税人编号之后
            Qsc.bind($("#payer_basic_info").find("[data-type='payerId']"),"keydown",function(e){
                
                if(e.which == 13){
                    var content = $(this).val().trim();
                    for(var i in TaxpayerInfo){
                        if(TaxpayerInfo[i]["payerId"] == content){
                            for(var k in TaxpayerInfo[i]){
                                $("#payer_basic_info").find("[data-type='"+k+"']").val(TaxpayerInfo[i][k]);
                            }
                            $(this).attr("disabled","disabled");
                            
                            //清空主税表
                            $("#taxverifygv").find("table").find("tr:gt(0)").remove();
                            mainTaxValueId = 0;
                            
                            //添加默认主税情况
                            for(var k in TaxpayerInfo[i]["mainTaxList"]){
                                addMainTaxLine(TaxpayerInfo[i]["mainTaxList"][k]);
                            }
                        }
                    }
                }
                
            });
            
            
            //保存按钮
            Qsc.bind($("#tb_savebtn"),"click",function(){
                if($("#tb_savebtn").hasClass("disabled")){
                    return;
                }
                $("#modal").css("display","block");
                $("#modal").find(".modal_info").html("是否要保存？");
                
                $("#modal").find("#modal_verify").css("display","inline-block");
                $("#modal").find("#modal_cancel").css("display","inline-block");
                
                Qsc.unbind($("#modal").find("#modal_verify"),"click");
                Qsc.unbind($("#modal").find("#modal_cancel"),"click");
                Qsc.bind($("#modal").find("#modal_verify"),"click",function(){
                    $("#modal").find(".modal_info").html("保存成功");
                    $("#modal").find("#modal_cancel").css("display","none");
                    Qsc.unbind($("#modal").find("#modal_verify"),"click");
                    Qsc.bind($("#modal").find("#modal_verify"),"click",function(){
                        $("#modal").css("display","none");
                        $("#tb_savebtn").addClass("disabled");
                        $("#tb_seeInfo").addClass("disabled");
                        $("#tb_seeVerify").addClass("disabled");
                    });
                });
                Qsc.bind($("#modal").find("#modal_cancel"),"click",function(){
                    $("#modal").css("display","none");
                });
                $("#modal").find(".modal_info").html("是否要保存？");
                
            });
            
            Qsc.bind($("#tb_next"),"click",function(){
                Qsc.getPart('module/shuizhongrending.html',"[data-module='module/shuizhongrending.html']");
            });
            
        
            //记录timepicker点的时间
            var time = new Date();
            
            //记录listviewpopup的值
            var lvalue = "";
            
            //初始化timepicker
            function initTimePicker(){
                var now = new Date();
                
                var monthpickerpanel = $("[data-pickertype='monthpicker']");
                var daypickerpanel = $("[data-pickertype='daypicker']");
                monthpickerpanel.find(".timepicker_titlecontent").html(now.getFullYear());
                Qsc.bind(monthpickerpanel.find(".timepicker_leftbtn"),"click",function(){
                    now.setFullYear(now.getFullYear()-1);
                    time.setFullYear(now.getFullYear());
                    monthpickerpanel.find(".timepicker_titlecontent").html(now.getFullYear());
                });
                Qsc.bind(monthpickerpanel.find(".timepicker_rightbtn"),"click",function(){
                    now.setFullYear(now.getFullYear()+1);
                    time.setFullYear(now.getFullYear());
                    monthpickerpanel.find(".timepicker_titlecontent").html(now.getFullYear());
                });
                
                Qsc.bind(monthpickerpanel.find(".timepicker_monthbtn"),"click",function(){
                    var month = $(this).html().split("月")[0];
                    time.setMonth(month-1);
                    
                    
                    var tempdate = new Date(time.getFullYear(),time.getMonth()+1,0);
                    
                    daypickerpanel.find(".timepicker_btngroup").html("");
                    var monthtext = parseInt(month);
                    daypickerpanel.find(".timepicker_titlecontent").html(monthtext+"月");
                    for(var i=1;i<=tempdate.getDate();i++){
                        daypickerpanel.find(".timepicker_btngroup").append("<div class=\"timepicker_daybtn\">"+i+"</div>");
                    }
                    Qsc.bind(daypickerpanel.find(".timepicker_daybtn"),"click",function(){
                        time.setDate($(this).html());
                        $("#timepicker").css("display","none");
                        
                        var datatype = $("#timepicker").attr("data-type");
                        var rowid = $("#timepicker").attr("data-rowid");
                        var table = $("#taxverifygv").find("table");
                        
                        table.find("tr[data-id='"+rowid+"']").find("td[data-type='"+datatype+"']").children("input").val(getTimerPickerDate());
                        
                    });
                    
                    
                    
                    monthpickerpanel.css("display","none");
                    daypickerpanel.css("display","block");
                    
                    
                });
                
                Qsc.bind(daypickerpanel.find(".timepicker_leftbtn"),"click",function(){
                    if(time.getMonth()-1 == -1){
                        time.setFullYear(time.getFullYear()-1);
                    }
                    now.setMonth(time.getMonth()-1);
                    time.setMonth(now.getMonth());
                    monthpickerpanel.find(".timepicker_titlecontent").html(now.getMonth());
                    
                    var month = now.getMonth();
                    var tempdate = new Date(time.getFullYear(),time.getMonth()+1,0);
                    
                    daypickerpanel.find(".timepicker_btngroup").html("");
                    var monthtext = parseInt(month) + 1;
                    daypickerpanel.find(".timepicker_titlecontent").html(monthtext+"月");
                    for(var i=1;i<=tempdate.getDate();i++){
                        daypickerpanel.find(".timepicker_btngroup").append("<div class=\"timepicker_daybtn\">"+i+"</div>");
                    }
                    Qsc.bind(daypickerpanel.find(".timepicker_daybtn"),"click",function(){
                        time.setDate($(this).html());
                        $("#timepicker").css("display","none");
                        
                        var datatype = $("#timepicker").attr("data-type");
                        var rowid = $("#timepicker").attr("data-rowid");
                        var table = $("#taxverifygv").find("table");
                        
                        table.find("tr[data-id='"+rowid+"']").find("td[data-type='"+datatype+"']").children("input").val(getTimerPickerDate());
                        
                    });
                });
                
                Qsc.bind(daypickerpanel.find(".timepicker_rightbtn"),"click",function(){
                    if(time.getMonth()+1 == 12){
                        time.setFullYear(time.getFullYear()+1);
                    }
                    now.setMonth(time.getMonth()+1);
                    time.setMonth(now.getMonth());
                    monthpickerpanel.find(".timepicker_titlecontent").html(now.getMonth());
                    
                    var month = now.getMonth();
                    console.log(month);
                    var tempdate = new Date(time.getFullYear(),time.getMonth()+1,0);
                
                    
                    daypickerpanel.find(".timepicker_btngroup").html("");
                    var monthtext = parseInt(month) + 1;
                    daypickerpanel.find(".timepicker_titlecontent").html(monthtext+"月");
                    for(var i=1;i<=tempdate.getDate();i++){
                        daypickerpanel.find(".timepicker_btngroup").append("<div class=\"timepicker_daybtn\">"+i+"</div>");
                    }
                    Qsc.bind(daypickerpanel.find(".timepicker_daybtn"),"click",function(){
                        time.setDate($(this).html());
                        $("#timepicker").css("display","none");
                        
                        var datatype = $("#timepicker").attr("data-type");
                        var rowid = $("#timepicker").attr("data-rowid");
                        var table = $("#taxverifygv").find("table");
                        
                        table.find("tr[data-id='"+rowid+"']").find("td[data-type='"+datatype+"']").children("input").val(getTimerPickerDate());
                        
                    });
                });
                
                Qsc.bind(daypickerpanel.find(".timepicker_titlecontent"),"click",function(){
                    daypickerpanel.css("display","none");
                    monthpickerpanel.css("display","block");
                });
                
                
            }
            initTimePicker();
            
            
            //显示timepicker
            function showTimePicker(){
                var now = new Date();
                
                time = now;
                var monthpickerpanel = $("[data-pickertype='monthpicker']");
                var daypickerpanel = $("[data-pickertype='daypicker']");
                daypickerpanel.css("display","none");
                monthpickerpanel.css("display","block");
                
                monthpickerpanel.find(".timepicker_titlecontent").html(now.getFullYear());
                $("#timepicker").css("display","block");
            }
            function getTimerPickerDate(){
                var _month = time.getMonth()+1;
                if(parseInt(_month)< 10){
                    _month = "0"+_month;
                }
                var _day = time.getDate();
                if(parseInt(_day)< 10){
                    _day = "0"+_day;
                }
                return time.getFullYear()+"-"+_month+"-"+_day;
            };
            
            //用来存放主税已经用到了多少行
            var mainTaxValueId = 0;
            
            var TaxpayerInfo = [
                {
                    payerId : "441412344567891",
                    payerName : "xxx房地产开发公司",
                    regType : "其他有限责任公司",
                    businessAddr : "XXX市XXX路XXX号",
                    productDistribute : "某个区",
                    businessStreet : "XXXX街道",
                    relationship : "区",
                    businessRange : "房地产开发与销售",
                    mainTaxList: [
                        {
                            mainTax: "主税",
                            handInWay: "自行申报",
                            industry: "房地产开发经营",
                            TaxDepart: "XX税务局征收股",
                            TaxType: "土地增值税",
                            VerifyDate: "2016-01-01",
                            VerifyDateEnd: "9999-12-31",
                            TaxItem: "其他类型房地产(预征)",
                            TaxSubItem: "商铺预征(4.0%)",
                            TaxRate: "0.040000",
                            TaxDeadline: "月",
                            RequestDeadline: "期满之日起15日内",
                            HandinDeadline: "税款所属时期后15天"
                        }
                    ],
                }
            ];
            
            //记录主税选项会影响到的值
            var mainTaxRelavantSet = {
                TaxItem: {
                    "101040001|应纳税所得额" : {
                        TaxRate: "0.250000",
                        TaxDeadline: "季",
                        RequestDeadline: "期满之日起15日内",
                        HandinDeadline: "税款所属时期后15天"
                    }
                }
            }
            
            //记录这些主税的选项数据
            var mainTaxDataSet = {
                mainTax: ["0|主税"],
                handInWay: ["0|自行申报","1|代收代缴","2|代扣代缴","9|其他征收代理方式"],
                TaxType: [	"10101|增值税",
                            "10103|营业税",
                            "10104|企业所得税",
                            "10105|企业所得税退税",
                            "10106|个人所得税",
                            "10107|资源税",
                            "10109|城市维护建设税",
                            "10110|房产税",
                            "10111|印花税",
                            "10112|城镇土地使用税",
                            "10113|土地增值税",
                            "10115|船舶吨税",
                            "10118|耕地占用税",
                            "10119|契税",
                            "10120|烟叶税",
                            "10199|其他税收收入",
                            "30150|大中型水库库区基金",
                            "30175|废弃电器电子产品处理基金收入",
                            "30199|其他政府性基金收入",
                            "30203|教育费附加",
                            "30216|地方教育附加",
                            "30217|文化事业建设费",
                            "30218|残疾人就业保障金",
                            "30221|水利建设专项收入",
                            "30299|其他专项收入",
                            "30408|税务行政事业性收费收入",
                            "30446|水利行政事业性收费收入",
                            "30501|税务部门罚没收入",
                            "30701|海上石油矿区使用费",
                            "30702|陆上石油矿区使用费",
                            "39900|其他收入"
                          ],
                TaxItem: ["101040001|应纳税所得额"],
                TaxSubItem: ["1010400012440200|建筑企业跨地区项目预分企业所得税0.2%"],
                TaxDeadline: ["06|月","08|季"],
                RequestDeadline: [  "08|企业所得税汇算清缴专用(5月31号)",
                                    "02|期满之日起7日内",
                                    "03|期满之日起10日内",
                                    "04|期满之日起15日内",
                                    "99|其他",
                                    "07|期满之日起3个月内",
                                    "01|期满之日起5日内",
                                    "05|期满之日起30日内",
                                    "06|期满之日起60日内",
                                    "09|期满当月月底",
                                    "09|期满当月月底",
                                    "54|4月30日或10月31日",
                                    "11|申报日后3天",
                                    "56|当年12月31日",
                                    "10|申报日后下月月底",
                                    "55|1月31日或7月31日",
                                    "76|当年3月、6月、9月、12月15",
                                    "92|期满之日起6个月内",
                                    "73|税款所属期起30日内",
                                    "77|当年4月15日",
                                    "82|当年6月20日或当年12月20日",
                                    "83|次年12月31日",
                                    "84|申报日后30天",
                                    "88|当年3月15日或当年9月15日",
                                    "89|期满之日起7个月内",
                                    "91|期满之日起3日内",
                                    "41|期满之日起5个月内",
                                    "25|1月31日或7月15日",
                                    "26|4月15日或10月15日",
                                    "27|5月15日或11月15日",
                                    "58|季后15天",
                                    "59|当年3月31日或当年9月30日",
                                    "72|当年1月31日或当年7月31日",
                                    "74|次年9月30日",
                                    "75|当年6月15日或当年12月15日",
                                    "85|合同签订之日起730",
                                    "86|当年10月20日",
                                    "90|次年11月30日",
                                    "96|期满之日起90日内",
                                    "94|申报日后15天",
                                    "12|税款所属时期后20天",
                                    "13|税款所属时期后25天",
                                    "14|税款所属时期后31天",
                                    "15|税款所属时期后40天",
                                    "16|次年1月31日",
                                    "17|次年4月30日",
                                    "18|次年5月31日",
                                    "19|次年1月15日",
                                    "20|当年7月31日",
                                    "21|当年9月30日",
                                    "22|当年10月31日",
                                    "23|当年8月31日",
                                    "24|当年11月30日",
                                    "28|次年3月31日",
                                    "29|次年6月30日",
                                    "30|当年11月15日",
                                    "31|当年1月31日",
                                    "32|当年3月31日",
                                    "33|当年5月15日",
                                    "34|当年5月31日",
                                    "35|当年6月30日",
                                    "36|税款所属时期后45天",
                                    "37|税款所属时期后10天",
                                    "38|税款所属时期后15天",
                                    "39|税款所属时期后20天",
                                    "78|当年5月20日或当年11月20日",
                                    "79|当年5月20日",
                                    "80|当年5月31日或当年11月30日",
                                    "81|当年4月30日或当年10月31日",
                                    "87|当年4月15日或当年10月15日"
                                 ],
                HandinDeadline: [  "08|企业所得税汇算清缴专用(5月31号)",
                                    "02|期满之日起7日内",
                                    "03|期满之日起10日内",
                                    "04|期满之日起15日内",
                                    "99|其他",
                                    "07|期满之日起3个月内",
                                    "01|期满之日起5日内",
                                    "05|期满之日起30日内",
                                    "06|期满之日起60日内",
                                    "09|期满当月月底",
                                    "09|期满当月月底",
                                    "54|4月30日或10月31日",
                                    "11|申报日后3天",
                                    "56|当年12月31日",
                                    "10|申报日后下月月底",
                                    "55|1月31日或7月31日",
                                    "76|当年3月、6月、9月、12月15",
                                    "92|期满之日起6个月内",
                                    "73|税款所属期起30日内",
                                    "77|当年4月15日",
                                    "82|当年6月20日或当年12月20日",
                                    "83|次年12月31日",
                                    "84|申报日后30天",
                                    "88|当年3月15日或当年9月15日",
                                    "89|期满之日起7个月内",
                                    "91|期满之日起3日内",
                                    "41|期满之日起5个月内",
                                    "25|1月31日或7月15日",
                                    "26|4月15日或10月15日",
                                    "27|5月15日或11月15日",
                                    "58|季后15天",
                                    "59|当年3月31日或当年9月30日",
                                    "72|当年1月31日或当年7月31日",
                                    "74|次年9月30日",
                                    "75|当年6月15日或当年12月15日",
                                    "85|合同签订之日起730",
                                    "86|当年10月20日",
                                    "90|次年11月30日",
                                    "96|期满之日起90日内",
                                    "94|申报日后15天",
                                    "12|税款所属时期后20天",
                                    "13|税款所属时期后25天",
                                    "14|税款所属时期后31天",
                                    "15|税款所属时期后40天",
                                    "16|次年1月31日",
                                    "17|次年4月30日",
                                    "18|次年5月31日",
                                    "19|次年1月15日",
                                    "20|当年7月31日",
                                    "21|当年9月30日",
                                    "22|当年10月31日",
                                    "23|当年8月31日",
                                    "24|当年11月30日",
                                    "28|次年3月31日",
                                    "29|次年6月30日",
                                    "30|当年11月15日",
                                    "31|当年1月31日",
                                    "32|当年3月31日",
                                    "33|当年5月15日",
                                    "34|当年5月31日",
                                    "35|当年6月30日",
                                    "36|税款所属时期后45天",
                                    "37|税款所属时期后10天",
                                    "38|税款所属时期后15天",
                                    "39|税款所属时期后20天",
                                    "78|当年5月20日或当年11月20日",
                                    "79|当年5月20日",
                                    "80|当年5月31日或当年11月30日",
                                    "81|当年4月30日或当年10月31日",
                                    "87|当年4月15日或当年10月15日"
                                 ]
            };
            
            
            //增加主税行,dataset:默认数据
            function addMainTaxLine(dataset){
                var _dataset = {
                    mainTax: "主税",
                    handInWay: "自行申报",
                    industry: "",
                    TaxDepart: "XX税务局征收股",
                    TaxType: "",
                    VerifyDate: "",
                    VerifyDateEnd: "",
                    TaxItem: "",
                    TaxSubItem: "",
                    TaxRate: "",
                    TaxDeadline: "",
                    RequestDeadline: "",
                    HandinDeadline: ""
                };
                if(dataset != undefined){
                    for(var i in dataset){
                        _dataset[i] = dataset[i];
                    }
                }
                var table = $("#taxverifygv").find("table");
                mainTaxValueId++;
                table.append("<tr data-id=\""+mainTaxValueId+"\" data-qscid=\"mainTaxRow"+mainTaxValueId+"\">" +
                                    "<td data-type=\"mainTax\"><input type=\"text\" class=\"trans\" value=\""+_dataset["mainTax"]+"\"></td>" +
                                    "<td data-type=\"handInWay\"><input type=\"text\" class=\"trans\" value=\""+_dataset["handInWay"]+"\"></td>" +
                                    "<td data-type=\"industry\"><input type=\"text\" class=\"trans\" value=\""+_dataset["industry"]+"\"></td>" +
                                    "<td data-type=\"TaxDepart\"><input type=\"text\" class=\"trans\" value=\""+_dataset["TaxDepart"]+"\"></td>" +
                             
                                    "<td data-type=\"TaxType\" data-blinkid='taxtype"+mainTaxValueId+"'><input type=\"text\" data-qscid='taxtype"+mainTaxValueId+"' class=\"trans\" value=\""+_dataset["TaxType"]+"\"></td>" +
                             
                                    "<td data-type=\"VerifyDate\" data-blinkid='verifydate"+mainTaxValueId+"'><input type=\"text\" class=\"trans\" data-qscid='verifydate"+mainTaxValueId+"' value=\""+_dataset["VerifyDate"]+"\"></td>" +
                             
                                    "<td data-type=\"VerifyDateEnd\" data-blinkid='verifydateend"+mainTaxValueId+"'><input type=\"text\" data-qscid='verifydateend"+mainTaxValueId+"' value=\""+_dataset["VerifyDateEnd"]+"\" class=\"trans\"></td>" +
                                    "<td data-type=\"TaxItem\" data-blinkid='taxitem"+mainTaxValueId+"'><input type=\"text\" class=\"trans\" data-qscid='taxitem"+mainTaxValueId+"' value=\""+_dataset["TaxItem"]+"\"></td>" +
                             
                                    "<td data-type=\"TaxSubItem\"data-blinkid='taxsubitem"+mainTaxValueId+"'><input type=\"text\" class=\"trans\" data-qscid='taxsubitem"+mainTaxValueId+"' value=\""+_dataset["TaxSubItem"]+"\"></td>" +
                             
                                    "<td data-type=\"TaxRate\" data-blinkid='taxrate"+mainTaxValueId+"'><input type=\"text\" class=\"trans\" data-qscid='taxrate"+mainTaxValueId+"' value=\""+_dataset["TaxRate"]+"\"></td>" +
                                    "<td data-type=\"TaxDeadline\" data-blinkid='taxdeadline"+mainTaxValueId+"'><input type=\"text\" class=\"trans\" data-qscid='taxdeadline"+mainTaxValueId+"' value=\""+_dataset["TaxDeadline"]+"\"></td>" +
                                    "<td data-type=\"RequestDeadline\" data-blinkid='requestdeadline"+mainTaxValueId+"'><input type=\"text\" class=\"trans\" data-qscid='requestdeadline"+mainTaxValueId+"' value=\""+_dataset["RequestDeadline"]+"\"></td>" +
                                    "<td data-type=\"HandinDeadline\" data-blinkid='handindeadline"+mainTaxValueId+"'><input type=\"text\" class=\"trans\" data-qscid='handindeadline"+mainTaxValueId+"' value=\""+_dataset["HandinDeadline"]+"\"></td>" +
                                "</tr>");
                
                Qsc.unbind(table.find("td"),"click");
                Qsc.bind(table.find("td"),"click",function(){
                    var clickedtd = $(this); 
                    var top = clickedtd.position().top-215;
                    var left = clickedtd.position().left;
                    var datatype = $(this).attr("data-type");
                    clickedtd.children("input").addClass("active");
                    $("#listview").attr("data-rowid",mainTaxValueId);
                    $("#listview").attr("data-type",datatype);
                    $("#timepicker").attr("data-rowid",mainTaxValueId);
                    $("#timepicker").attr("data-type",datatype);
                    switch(datatype){
                            
                            //以下选项显示下拉框
                        case "mainTax":
                        case "handInWay":
                        case "TaxType":
                        case "TaxItem":
                        case "TaxSubItem":
                        case "TaxDeadline":
                        case "RequestDeadline":
                        case "HandinDeadline":
                            Qsc.unbind($("#listview").children("div"),"click");
                            $("#listview").html("");
                            for(var i in mainTaxDataSet[datatype]){
                                $("#listview").append("<div>"+mainTaxDataSet[datatype][i]+"</div>");
                            }
                            Qsc.bind($("#listview").children("div"),"click",function(){
                                var _id =$("#listview").attr("data-rowid");
                                var _dt = $("#listview").attr("data-type");
                                $("#listview").css("display","none");
                                
                                //设置文本框的值
                                var _val = $(this).html();
                                $("tr[data-id='"+_id+"']").find("td[data-type='"+_dt+"']").children("input").val(_val.split("|")[1]);
                                
                                //设置影响到的项目值
                                if(mainTaxRelavantSet[_dt]!=undefined){
                                    for(var i in mainTaxRelavantSet[_dt]){
                                        if(i == _val){
                                            for(var k in mainTaxRelavantSet[_dt][i]){
                                                
                                                $("tr[data-id='"+_id+"']").find("td[data-type='"+k+"']").children("input").val(mainTaxRelavantSet[_dt][i][k]);
                                            }
                                        }
                                    }
                                }
                            });
                            $("#listview").css("display","block");
                            $("#listview").focus();
                            clickedtd.children("input").removeClass("active");
                            Qsc.unbind(clickedtd.children("input"),"blur");
                            Qsc.bind(clickedtd.children("input"),"blur",function(){
                                clickedtd.children("input").removeClass("active");
                            });
                            
                            
                            top = top < 0? 0 : top;
                            left = left < 0 ? 0 : left;
                            
                            $("#listview").css("top",top+"px");
                            $("#listview").css("left",left+"px");
                            break;
                            
                            //以下选项显示时间选择器
                        case "VerifyDate":
                        case "VerifyDateEnd":
                            showTimePicker();
                            $("#timepicker").css("top",top+30+"px");
                            $("#timepicker").css("left",left+"px");
                            
                            
                            var _onthetimepicker = false;
                            Qsc.unbind(clickedtd.children("input"),"blur");
                            Qsc.bind(clickedtd.children("input"),"blur",function(){
                                
                                if(clickedtd.children("input").is(":focus") || $("#timepicker").is(":focus") || _onthetimepicker){
                                }else{
                                    $("#timepicker").css("display","none");
                                    clickedtd.children("input").removeClass("active");
                                }
                            });
                            
                            Qsc.unbind($("#timepicker"),"mouseover");
                            Qsc.bind($("#timepicker"),"mouseover",function(){
                                _onthetimepicker = true;
                            });
                            
                            
                            Qsc.unbind($("#timepicker"),"mouseleave");
                            Qsc.bind($("#timepicker"),"mouseleave",function(){
                                _onthetimepicker = false;
                            });
                            
                            Qsc.unbind($("#timepicker"),"blur");
                            Qsc.bind($("#timepicker"),"blur",function(){
                                if(clickedtd.is(":focus") || $("#timepicker").is(":focus")){
                                }else{
                                    $("#timepicker").css("display","none");
                                    clickedtd.children("input").removeClass("active");
                                }
                            });
                            
                            break;
                        default:
                            Qsc.unbind(clickedtd.children("input"),"blur");
                            Qsc.bind(clickedtd.children("input"),"blur",function(){
                                clickedtd.children("input").removeClass("active");
                            });
                            break;
                    }
                    
                    
                });
                
            }
            
            
            
        })();
    
    </script>
</div>